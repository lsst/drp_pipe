description: The DRP Fakes pipeline specalised for the HSC RC2 dataset.
instrument: lsst.obs.subaru.HyperSuprimeCam
imports:
  location: "$DRP_PIPE_DIR/pipelines/_ingredients/HSC/DRP.yaml"
  exclude:
    - skyCorr
    - jointcal
    - gbdesAstrometricFit
    - fgcm
    - fgcmBuildFromIsolatedStars
    - fgcmFitCycle
    - fgcmOutputProducts
    - isr
    - characterizeImage
    - calibrate
    - selectGoodSeeingVisits
    - templateGen
    - subtractImages
    - detectAndMeasureDiaSources
    - transformDiaSourceCat
    - consolidateDiaSourceTable
    - drpAssociation
    - drpDiaCalculation
    - forcedPhotDiffim
    - forcedPhotCcdOnDiaObjects
    - forcedPhotDiffOnDiaObjects
    - transformForcedSourceTable
    - consolidateForcedSourceTable
    - getTemplate
    - writeForcedSourceTable
    - consolidateAssocDiaSourceTable
    - consolidateFullDiaObjectTable
    - writeForcedSourceOnDiaObjectTable
    - transformForcedSourceOnDiaObjectTable
    - consolidateForcedSourceOnDiaObjectTable
    - consolidateVisitSummary
    - isolatedStarAssociation
    - finalizeCharacterization
    - updateVisitSummary
    - makeCcdVisitTable
    - makeVisitTable
    - healSparsePropertyMaps
    - consolidateHealSparsePropertyMaps
    - analyzeObjectTableCore
    - analyzeObjectTableSurveyCore
    - catalogMatchTract
    - refCatObjectTract
    - faro_all
tasks:
  singleFrameWithFakes:
    class: lsst.pipe.tasks.processCcdWithFakes.ProcessCcdWithFakesTask
    config:
      insertFakes.doProcessAllDataIds: true
      doApplyExternalGlobalPhotoCalib: true
      doApplyExternalGlobalSkyWcs: true
  writePreSourceTable:
    class: lsst.pipe.tasks.postprocess.WriteSourceTableTask
    config:
      connections.catalogType: "fakes_"
      connections.outputCatalog: fakes_preSource
  transformPreSourceTable:
    class: lsst.pipe.tasks.postprocess.TransformSourceTableTask
    config:
      connections.inputCatalog: fakes_preSource
      connections.outputCatalog: fakes_preSourceTable
  consolidatePreSourceTable:
    class: lsst.pipe.tasks.postprocess.ConsolidateSourceTableTask
    config:
      connections.inputCatalogs: fakes_preSourceTable
      connections.outputCatalog: fakes_preSourceTable_visit
  writeRecalibratedSourceTable:
    class: lsst.pipe.tasks.postprocess.WriteRecalibratedSourceTableTask
    config:
      connections.outputCatalog: fakes_source
      connections.catalogType: "fakes_"
  transformSourceTable:
    class: lsst.pipe.tasks.postprocess.TransformSourceTableTask
    config:
      connections.catalogType: "fakes_"
  consolidateSourceTable:
    class: lsst.pipe.tasks.postprocess.ConsolidateSourceTableTask
    config:
      connections.catalogType: "fakes_"
  assembleCoadd:
    class: lsst.pipe.tasks.assembleCoadd.CompareWarpAssembleCoaddTask
    config:
      connections.inputCoaddName: "fakes_deep"
      connections.outputCoaddName: "fakes_deep"
  makeWarp:
    class: lsst.pipe.tasks.makeWarp.MakeWarpTask
    config:
      connections.photoCalibName: "fgcm"
      useGlobalExternalPhotoCalib: true
      connections.coaddName: "fakes_deep"
      connections.calexpType: "fakes_"
  detection:
    class: lsst.pipe.tasks.multiBand.DetectCoaddSourcesTask
    config:
      connections.inputCoaddName: "fakes_deep"
      connections.outputCoaddName: "fakes_deep"
  mergeDetections:
    class: lsst.pipe.tasks.mergeDetections.MergeDetectionsTask
    config:
      connections.inputCoaddName: "fakes_deep"
      connections.outputCoaddName: "fakes_deep"
  deblend:
    class: lsst.pipe.tasks.deblendCoaddSourcesPipeline.DeblendCoaddSourcesMultiTask
    config:
      connections.inputCoaddName: "fakes_deep"
      connections.outputCoaddName: "fakes_deep"
  measure:
    class: lsst.pipe.tasks.multiBand.MeasureMergedCoaddSourcesTask
    config:
      connections.inputCoaddName: "fakes_deep"
      connections.outputCoaddName: "fakes_deep"
  mergeMeasurements:
    class: lsst.pipe.tasks.mergeMeasurements.MergeMeasurementsTask
    config:
      connections.inputCoaddName: "fakes_deep"
      connections.outputCoaddName: "fakes_deep"
  writeObjectTable:
    class: lsst.pipe.tasks.postprocess.WriteObjectTableTask
    config:
      connections.coaddName: "fakes_deep"
  transformObjectTable:
    class: lsst.pipe.tasks.postprocess.TransformObjectCatalogTask
    config:
      connections.coaddName: "fakes_deep"
  forcedPhotCcd:
    class: lsst.meas.base.forcedPhotCcd.ForcedPhotCcdTask
    config:
      connections.inputCoaddName: "fakes_deep"
      connections.exposure: "fakes_calexp"
  forcedPhotCoadd:
    class: lsst.meas.base.forcedPhotCoadd.ForcedPhotCoaddTask
    config:
      connections.inputCoaddName: "fakes_deep"
      connections.outputCoaddName: "fakes_deep"
