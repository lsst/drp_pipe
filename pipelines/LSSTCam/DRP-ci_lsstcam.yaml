description: LSSTCam specialization of the DRP pipeline
instrument: lsst.obs.lsst.LsstCam
imports:
  - location: $DRP_PIPE_DIR/pipelines/_ingredients/LSSTCam/DRP.yaml
    labeledSubsetModifyMode: EDIT
    exclude:
      - skyCorr
      - gbdesHealpix3AstrometricFit
      - gaussianProcessesTurbulenceFit
      - fgcmBuildFromIsolatedStar
      - fgcmFitCycle
      - fgcmOutputProducts
      - makePrettyDirectWarp
      - makePrettyPsfMatchedWarp
      - assemblePrettyCoadd
      - makeBinnedPrettyCoaddImage
      - makeWholeTractPrettyCoaddImage
      - makeBinnedPrettyNImage
      - makeWholeTractPrettyNImage
tasks:
  # TODO DM-53523: This config override should be removed when the
  # correct calibrations are added to the testdata packages.
  isr:
    class: lsst.ip.isr.IsrTaskLSST
    config:
      brighterFatterCorrectionMethod: "COULTON18"
  # Config overrides for both missing skyCorr and gbdesHealpix3AstrometricFit
  updateVisitSummary:
    class: lsst.drp.tasks.update_visit_summary.UpdateVisitSummaryTask
    config:
      background_provider: input_summary
      wcs_provider: input_summary
      wcs_consistency_threshold: null
      photo_calib_provider: input_summary
  # Config overrides for missing skyCorr
  makeDirectWarp:
    class: lsst.drp.tasks.make_direct_warp.MakeDirectWarpTask
    config:
      doApplySkyCorr: false
  # This config override for shear_bands  may be removed if the
  # task-default bands are available in the ci_lsstcam dataset.
  metadetectionShear:
    class: lsst.drp.tasks.metadetection_shear.MetadetectionShearTask
    config:
      python: |
        config.metadetect.shear_bands = ["r", "i"]
  reprocessVisitImage:
    class: lsst.drp.tasks.reprocess_visit_image.ReprocessVisitImageTask
    config:
      do_use_sky_corr: false
  # Config overrides for missing gbdesHealpix3AstrometricFit
  analyzeRecalibratedStarAssociation:
    class: lsst.analysis.tools.tasks.AssociatedSourcesTractAnalysisTask
    config:
      applyAstrometricCorrections: false
  analyzeRecalibratedStarObjectMatch:
    class: lsst.analysis.tools.tasks.SourceObjectTableAnalysisTask
    config:
      applyAstrometricCorrections: false
  analyzeSourceAssociation:
    class: lsst.analysis.tools.tasks.AssociatedSourcesTractAnalysisTask
    config:
      applyAstrometricCorrections: false
  # Be a little more permissive on number of visits allowed into coadds
  selectTemplateCoaddVisits:
    class: lsst.pipe.tasks.selectImages.BestSeeingQuantileSelectVisitsTask
    config:
      python: |
        config.visitSummaryMinValues = {'effTimeZeroPointScale': 0.5}
  selectDeepCoaddVisits:
    class: lsst.pipe.tasks.selectImages.BestSeeingSelectVisitsTask
    config:
      python: |
        config.visitSummaryMinValues = {'effTimeZeroPointScale': 0.5}
  analyzeObjectTableCore:
    class: lsst.analysis.tools.tasks.ObjectTableTractAnalysisTask
    config:
      atools.wPerpPSF.prep.selectors.snSelector.threshold: 50
      atools.xPerpPSF.prep.selectors.snSelector.threshold: 50
      atools.yPerpPSF.prep.selectors.snSelector.threshold: 50
      atools.wPerpCModel.prep.selectors.snSelector.threshold: 50
      atools.xPerpCModel.prep.selectors.snSelector.threshold: 50
      atools.yPerpCModel.prep.selectors.snSelector.threshold: 50
