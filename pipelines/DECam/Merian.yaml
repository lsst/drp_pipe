description: The DRP pipeline specialized for the DECam instrument
instrument: lsst.obs.decam.DarkEnergyCamera
imports:
  location: $DRP_PIPE_DIR/ingredients/DRP.yaml
tasks:
  isrForCrosstalkSources:
    class: lsst.ip.isr.IsrTask
    config:
    - connections.outputExposure: overscanRaw
      doOverscan: true
      doAssembleCcd: false
      doBias: false
      doVariance: false
      doLinearize: false
      doDefect: false
      doNanMasking: false
      doDark: false
      doFlat: false
      doFringe: false
      doInterpolate: false
  isr:
    class: lsst.ip.isr.IsrTask
    config:
    - connections.crosstalkSources: overscanRaw
      doCrosstalk: true
  calibrate:
    class: lsst.pipe.tasks.calibrate.CalibrateTask
    config:
    - photoCal.match.referenceSelection.magLimit.fluxField: i_flux
      photoCal.match.referenceSelection.magLimit.maximum: 22.0
  makeWarp:
    class: lsst.pipe.tasks.makeCoaddTempExp.MakeWarpTask
    config:
    - doWriteEmptyWarps: true
    - python: 'from lsst.pipe.tasks.selectImages import PsfWcsSelectImagesTask;
        config.select.retarget(PsfWcsSelectImagesTask)
        
        '
  assembleCoadd:
    class: lsst.pipe.tasks.assembleCoadd.CompareWarpAssembleCoaddTask
    config:
    - doSelectVisits: true
      doNImage: true
      assembleStaticSkyModel.doSelectVisits: true
subsets:
  processCcd:
    subset:
    - isr
    - characterizeImage
    - calibrate
    description: 'An alias of ProcessCcd to use in higher-level pipelines.
      
      '
  step0:
    subset:
    - isrForCrosstalkSources
    description: 'Tasks which should be run once, prior to initial data processing.

      This step generates crosstalk sources for ISR/inter-chip crosstalk by applying 
      overscan correction on raw frames. A new dataset is written, which should be 
      used as an input for further data processing.
      
      '
  step1:
    subset:
    - isr
    - characterizeImage
    - calibrate
    - transformSourceTable
    - writeSourceTable
    description: 'Per-detector tasks that can be run together to start the DRP pipeline.

      These should never be run with ''tract'' or ''patch'' as part of the data ID
      expression if any later steps will also be run, because downstream steps require
      full visits and ''tract'' and ''patch'' constraints will always select partial
      visits that overlap that region.
      
      '
  step2:
    subset:
    - consolidateSourceTable
    - consolidateVisitSummary
    description: 'Per-visit tasks that can be run together, but only after ''step1''.

      These should never be run with ''tract'' or ''patch'' as part of the data ID
      expression.
      
      '
  step3:
    subset:
    - selectGoodSeeingVisits
    - templateGen
    - makeWarp
    - deblend
    - detection
    - writeObjectTable
    - measure
    - mergeMeasurements
    - assembleCoadd
    - forcedPhotCoadd
    - transformObjectTable
    - consolidateObjectTable
    - mergeDetections
    description: 'Tract-level tasks that can be run together, but only after the ''step1''
      and ''step2'' subsets.

      These should be run with explicit ''tract'' constraints essentially all the
      time, because otherwise quanta will be created for jobs with only partial visit
      coverage.
      
      '
  step7:
    subset:
    - makeVisitTable
    - makeCcdVisitTable
    description: 'Tasks that should be run as the final step that require global inputs,
      and can be run after the ''step3'' subset.
      
      This step has global aggregation tasks to run over all visits, detectors, tracts,
      etc.  This step should be run only with the instrument constraint in the data
      query.
      
      '
