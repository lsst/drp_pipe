# This BPS configuration snippet adds requestMemory values for DRP
# and tasks.
#
# Use it by adding:
#
#   includeConfigs:
#     - ${DRP_PIPE_DIR}/bps/resources/LSSTCam/DRP.yaml
#
# (with no outer indentation) to your BPS config file.

pipetask:
  # 95th percentile memory usage from w_2025_45 DP2 Pilot DRP
  # Values are measured per cluster not per-task
  analyzeDiaSourceTableTract:
    requestMemory: 2822
  analyzeObjectTableCore:
    requestMemory: 6117
  analyzeObjectTableSurveyCore:
    requestMemory: 103905
  analyzeRecalibratedStarAssociation:
    requestMemory: 99057
  analyzeRecalibratedStarObjectMatch:
    requestMemory: 3824
  analyzeSingleVisitStarAssociation:
    requestMemory: 104352
  analyzeSourceAssociation:
    requestMemory: 50297
  assembleCellCoadd:
    requestMemory: 7000
  assembleDeepCoadd:
    requestMemory: 7000
  assembleTemplateCoadd:
    requestMemory: 7000
  associateAnalysisSource:
    requestMemory: 34780
  associateDiaSource:
    requestMemory: 2434
  associateIsolatedStar:
    requestMemory: 22158
  buildTemplate:
    requestMemory: 4449
  calculateDiaObject:
    requestMemory: 2434
  calibrateImage:
    requestMemory: 4771
  catalogMatchTract:
    requestMemory: 4774
  computeObjectEpochs:
    requestMemory: 6581
  computeReliability:
    requestMemory: 4449
  consolidateDiaObject:
    requestMemory: 2433
  consolidateDiaSource:
    requestMemory: 3953
  consolidateHealSparsePropertyMaps:
    requestMemory: 5194
  consolidateObject:
    requestMemory: 10259
  consolidateRecalibratedStar:
    requestMemory: 2088
  consolidateRefitPsfModelDetector:
    requestMemory: 2127
  consolidateSingleVisitStar:
    requestMemory: 2094
  consolidateSource:
    requestMemory: 2868
  consolidateSsTables:
    requestMemory: 3726
  consolidateVisitSummary:
    requestMemory: 2094
  deblendCoaddFootprints:
    requestMemory: 6661
  detectAndMeasureDiaSource:
    requestMemory: 4449
  detectCoaddPeaks:
    requestMemory: 7000
  fgcmOutputProducts:
    requestMemory: 12642
  filterDiaSource:
    requestMemory: 4449
  filterDiaSourcePostReliability:
    requestMemory: 4449
  fitDeblendedObjectsExp:
    requestMemory: 4395
  fitDeblendedObjectsSersic:
    requestMemory: 4410
  forcedPhotDiaObjectDetector:
    requestMemory: 2432
  forcedPhotObjectDetector:
    requestMemory: 2433
  isr:
    requestMemory: 4762
  makeAnalysisRecalibratedStarAssociationWholeSkyPlot:
    requestMemory: 3677
  makeAnalysisSingleVisitStarAssociationWholeSkyPlot:
    requestMemory: 3716
  makeAnalysisSourceAssociationMetricTable:
    requestMemory: 2435
  makeAnalysisSourceAssociationWholeSkyPlot:
    requestMemory: 4643
  makeDirectWarp:
    requestMemory: 3366
  makeHealSparsePropertyMaps:
    requestMemory: 8163
  makePsfMatchedWarp:
    requestMemory: 3374
  measureObjectForced:
    requestMemory: 2887
  measureObjectUnforced:
    requestMemory: 2905
  objectTableCoreWholeSkyPlot:
    requestMemory: 4498
  photometricCatalogMatch:
    requestMemory: 4546
  plotPropertyMapSurvey:
    requestMemory: 32727
  plotPropertyMapTract:
    requestMemory: 5008
  refitPsfModelDetector:
    requestMemory: 6080
  reprocessVisitImage:
    requestMemory: 6368
  rewriteObject:
    requestMemory: 6581
  skyCorr:
    requestMemory: 15784
  splitPrimaryObject:
    requestMemory: 25232
  splitPrimaryObjectForcedSource:
    requestMemory: 3080
  splitPrimarySource:
    requestMemory: 5433
  standardizeDiaObjectForcedSource:
    requestMemory: 2428
  standardizeDiaSource:
    requestMemory: 4449
  standardizeObject:
    requestMemory: 6580
  standardizeObjectForcedSource:
    requestMemory: 2790
  standardizeSingleVisitStar:
    requestMemory: 5094
  standardizeSource:
    requestMemory: 6587
  subtractImages:
    requestMemory: 4449
  updateVisitSummary:
    requestMemory: 4562
  fgcmBuildFromIsolatedStar:
    requestMemory: 128000
  fgcmFitCycle:
    requestMemory: 480000
    requestCpus: 60
    extraRunQuantumOptions: "-j 1 -n 60"
  gbdesAstrometricFit:
    requestMemory: 88165
    requestCpus: 10
    extraRunQuantumOptions: "-j 1 -n 10 --no-raise-on-partial-outputs"
  gbdesHealpix3AstrometricFit:
    requestMemory: 88165
    requestCpus: 10
    extraRunQuantumOptions: "-j 1 -n 10 --no-raise-on-partial-outputs"
