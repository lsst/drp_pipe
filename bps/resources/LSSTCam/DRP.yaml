# This BPS configuration snippet adds requestMemory values for DRP
# and tasks.
#
# Use it by adding:
#
#   includeConfigs:
#     - ${DRP_PIPE_DIR}/bps/resources/LSSTCam/DRP.yaml
#
# (with no outer indentation) to your BPS config file.

pipetask:
  # 95th percentile memory usage from w_2025_41 DP2 Pilot DRP
  # Values are measured per cluster not per-task
  analyzeObjectTableCore:
    requestMemory: 4655
  analyzeObjectTableSurveyCore:
    requestMemory: 63124
  analyzeRecalibratedStarAssociation:
    requestMemory: 31387
  analyzeRecalibratedStarObjectMatch:
    requestMemory: 2475
  analyzeSingleVisitStarAssociation:
    requestMemory: 37984
  analyzeSourceAssociation:
    requestMemory: 49153
  assembleCellCoadd:
    requestMemory: 7000
  assembleDeepCoadd:
    requestMemory: 7000
  assembleTemplateCoadd:
    requestMemory: 7000
  associateAnalysisSource:
    requestMemory: 25270
  associateIsolatedStar:
    requestMemory: 13058
  buildTemplate:
    requestMemory: 3104
  calibrateImage:
    requestMemory: 4440
  catalogMatchTract:
    requestMemory: 4538
  computeObjectEpochs:
    requestMemory: 5104
  computeReliability:
    requestMemory: 3637
  consolidateDiaSource:
    requestMemory: 2116
  consolidateHealSparsePropertyMaps:
    requestMemory: 4587
  consolidateObject:
    requestMemory: 8640
  consolidateSingleVisitStar:
    requestMemory: 2023
  consolidateSource:
    requestMemory: 2414
  consolidateVisitSummary:
    requestMemory: 2023
  deblendCoaddFootprints:
    requestMemory: 6770
  detectAndMeasureDiaSource:
    requestMemory: 3582
  detectCoaddPeaks:
    requestMemory: 9163
  fgcmOutputProducts:
    requestMemory: 11067
  filterDiaSource:
    requestMemory: 3637
  filterDiaSourcePostReliability:
    requestMemory: 3637
  fitDeblendedObjectsExp:
    requestMemory: 4235
  fitDeblendedObjectsSersic:
    requestMemory: 4253
  isr:
    requestMemory: 4437
  makeAnalysisRecalibratedStarAssociationWholeSkyPlot:
    requestMemory: 3677
  makeAnalysisSingleVisitStarAssociationWholeSkyPlot:
    requestMemory: 3642
  makeAnalysisSourceAssociationWholeSkyPlot:
    requestMemory: 3645
  makeDirectWarp:
    requestMemory: 3366
  makeHealSparsePropertyMaps:
    requestMemory: 7089
  makePsfMatchedWarp:
    requestMemory: 3374
  measureObjectForced:
    requestMemory: 2887
  measureObjectUnforced:
    requestMemory: 2905
  objectTableCoreWholeSkyPlot:
    requestMemory: 4498
  photometricCatalogMatch:
    requestMemory: 4546
  plotPropertyMapSurvey:
    requestMemory: 28627
  plotPropertyMapTract:
    requestMemory: 5008
  refitPsfModelDetector:
    requestMemory: 4643
  reprocessVisitImage:
    requestMemory: 3495
  rewriteObject:
    requestMemory: 5104
  skyCorr:
    requestMemory: 15784
  splitPrimaryObject:
    requestMemory: 21172
  splitPrimaryObjectForcedSource:
    requestMemory: 2153
  splitPrimarySource:
    requestMemory: 4874
  standardizeDiaSource:
    requestMemory: 3637
  standardizeObject:
    requestMemory: 5104
  standardizeObjectForcedSource:
    requestMemory: 2008
  standardizeSingleVisitStar:
    requestMemory: 4441
  standardizeSource:
    requestMemory: 3596
  subtractImages:
    requestMemory: 3306
  updateVisitSummary:
    requestMemory: 2528
  fgcmBuildFromIsolatedStar:
    requestMemory: 128000
  fgcmFitCycle:
    requestMemory: 256000
    requestCpus: 60
    extraRunQuantumOptions: "-j 1 -n 60"
  gbdesAstrometricFit:
    requestMemory: 84900
    requestCpus: 10
    extraRunQuantumOptions: "-j 1 -n 10 --no-raise-on-partial-outputs"
  gbdesHealpix3AstrometricFit:
    requestMemory: 84900
    requestCpus: 10
    extraRunQuantumOptions: "-j 1 -n 10 --no-raise-on-partial-outputs"
