# This is a prescription for quantum clustering with BPS with LSSTComCam DRP.
#
# Use it by adding:
#
#   includeConfigs:
#     - ${DRP_PIPE_DIR}/bps/clustering/LSSTCam/DRP-clustering.yaml
#
# (with no outer indentation) to your BPS config file.

clusterAlgorithm: lsst.ctrl.bps.quantum_clustering_funcs.dimension_clustering
cluster:
  step1detector:
    # shared with NV
    pipetasks: isr,calibrateImage,analyzeAmpOffsetMetadata,analyzeAmpInterfaceOffsetMetadata,analyzeInitialSummaryStats,analyzeCalibrateImageMetadata,standardizeSingleVisitStar
    dimensions: detector
    equalDimensions: visit:exposure
    partitionDimensions: exposure
    partitionMaxClusters: 50000
  step1b_visits:
    pipetasks: consolidateSingleVisitStar,consolidateVisitSummary
    dimensions: visit
  step2d_refitpsf:
    # These are detector-level tasks
    pipetasks: refitPsfModelDetector
    dimensions: visit
    partitionDimensions: detector
    partitionMaxClusters: 50000
  step2d_visits:
    # These are detector-level tasks
    pipetasks: recalibrateSingleVisitStar,standardizeRecalibratedStar
    dimensions: visit
    partitionDimensions: detector
    partitionMaxClusters: 50000
  makeWarpTract:
    # shared with NV
    pipetasks: makeDirectWarp,makePsfMatchedWarp,makePrettyDirectWarp,makePrettyPsfMatchedWarp
    dimensions: tract,visit
  coadd:
    # shared with NV
    pipetasks: selectDeepCoaddVisits,assembleDeepCoadd,assembleCellCoadd,detectCoaddPeaks,selectTemplateCoaddVisits,assembleTemplateCoadd
    dimensions: tract,patch,band
  make_analysis_images:
    pipetasks: makeBinnedTemplateNImage,makeBinnedDeepNImage,makeBinnedCoaddImage,makeBinnedPrettyNImage,makeBinnedPrettyCoaddImage
    dimensions: tract,band
  make_tract_analysis_images:
    pipetasks: makeWholeTractTemplateNImage,makeWholeTractDeepNImage,makeWholeTractImage,makeWholeTractPrettyCoaddImage,makeWholeTractPrettyNImage
    dimensions: tract,band
  patch_postprocess:
    pipetasks: rewriteObject,computeObjectEpochs,standardizeObject
    dimensions: tract,patch
  property_maps:
    pipetasks: makeHealSparsePropertyMaps
    dimensions: tract,band
  step4a_reprocess_standardize:
    pipetasks: reprocessVisitImage,standardizeSource
    dimensions: visit
    partitionDimensions: detector
    partitionMaxClusters: 50000
  diffim:
    pipetasks: buildTemplate,subtractImages,detectAndMeasureDiaSource,filterDiaSource,computeReliability,filterDiaSourcePostReliability,standardizeDiaSource
    dimensions: visit
    partitionDimensions: detector
    partitionMaxClusters: 50000
  association:
    pipetasks: associateDiaSource,calculateDiaObject
    dimensions: tract,patch
  skyCorrCluster:
    pipetasks: skyCorr,skyCorrExperimental
    dimensions: visit
  step4c_forced_phot:
    pipetasks: forcedPhotObjectDetector
    dimensions: visit
    partitionDimensions: detector
    partitionMaxClusters: 50000
  step4c_forced_phot_dia:
    pipetasks: forcedPhotDiaObjectDetector
    dimensions: visit
    partitionDimensions: detector
    partitionMaxClusters: 50000
